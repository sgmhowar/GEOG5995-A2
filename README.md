
# GEOG5995M Assignment 1 - Agent Based Modelling

## Introduction

This repository contains all the content created as part of the second assignment in the module 'Programming for Social Science: Core Skills' for the academic year 21/22. (This course, and the files used at several points in the project, can be found at https://www.geog.leeds.ac.uk/courses/computing/study/core-python-phd/). This work is published under an MIT license, a copy of which can be found in this repository.

All the code needed for the model can be found in the A2.ipynb notebook. The two files "wind" and "blank.txt" are also needed for the code to run.

## Overview

The title of the project undertaken to complete this assignment was **Bacterial Bomb** . The assigned context of this model was therefore as follows:

>A biological weapon has been detonated at a set height and coordinates and the potential fallout needs to be modelled. This is done using estimations of wind movements to determine bacteria transportation.

In order to accomplish this the model required several key steps:

 - Identify Ground Zero Site
 - Function to simulate horizontal movement
 - Function to simulate vertical movement
 - Function to track where bacteria land
 - Function to remove bacteria that land or move out of bounds
 - Plotting and assesing the final output
 
With the model completing when all bacteria have settled or been lost.

---

### Ground Zero

Before beginning to interact with the agents and model their movements, the starting parameters had to be established. Some of these values, such as wind speed and the probabilities of its direction were provided in the [Project Outline](https://www.geog.leeds.ac.uk/courses/computing/study/core-python-phd/assessment2/wind.html), but in the case of the actual coordinates for the intial bomb site, a 300x300 grid was provided instead. Within this grid was a single point marked **255**  denoting the site the bomb would be detonated at (all the other values were 0). To find the matching coordinates for this point I loaded the file into the model and combed through the grid until the value was found and extracted the coordinates [150,50]. With the starting location found, i could create my agents, attaching start coordinates (150, 50 as above), starting elevation (a pre-defined 75m) and a blank base map to track them eventually settling. In total, the model creates 5000 of these agents, although I added a slidebar to allow for easy altering of this volume. For reasons that became clear in testing (see relevant section) I also added a binary check to each agent to mark if they needed removing from the model.

---
###  Spreading Out
 When the model is running, every second each bacterium moves horizontally according to the probabilities shown in figure 1.
 
| **Direction** | **Probability** |
|--|--|
| North |  10%|
| East | 75% |
| South | 10% |
| West |  5%|

**Figure 1.** Horizontal Movement Probabilities

Using these probabilities, for each run through of the model every individual bacterium is assigned a random value between 1 and 100 which is then compared to the above table to determine how it's coordinates will change. Unsurpringly, due to the dominance of Easterly wind, by the time bacteria reached the ground they had almost universally across every run of the model moved east of the ground zero site.

The town boundaries are defined by the same 300x300 grid the bomb site was identified from, and if any falling bacteria move beyond these bounds they are removed from the model and marked as 'lost'.

---
### Experiencing a bit of turbulence
Furthermore to the horizontal movement, if a bacterium is at an elevation equal to or greater height it was released at (Default: 75 units), there is a chance the turbulence can prevent it from dropping, or even lift it higher.

|  **Elevation Change**| **Probability** |
|--|--|
| Rising | 20% |
| None | 10% |
| Falling | 70% |

**Figure 2.** Vertical Movement Probabilities

Unsurprisngly the vast majority of agentss are not influenced by this possibility, as falling on the first run through of the model drops you below the start height, ensuring the agent will consistently fall every iteration from then on.

---
### Touchdown
When the falling bacterium reaches the ground (i.e. their height = 0), their position has to marked. To do this, firstly, a new 300x300 grid of zeroes is loaded as a template. Whenever an agent is found to have reached the ground it's coordinates are compared to this template and the corresponding site has it's value increased by one. Once this is done, the agent has to be removed from the model to prevent it from being tracked multiple times.


---
### The Final Product

An example of the model generated by the project is shown below, with the red dot on the left marking the site of detonation:

![Model Example](/images/output.PNG)

**Figure 3.** Output Example

This figure in effect simply shows the blank template mentioned above, once all the bacteria have been tracked and removed from the system. As noted, the fallout is entirely to the east of the ground zero site, but with some minor distribution around a concentrated centre. Even with the random nature of the wind, due to the weighted probabilities the output is consistently similar no matter how many times the model is run. It should be noted that due to the scale of the observed environment and the rate of falling, no bacteria were lost in this case shown. Indeed, in all the test runs with a wind speed of one, whilst it is mathematically possible, no bacteria reached the edge of the map. Increasing the wind speed even slightly drastically changes this pattern, as many more agents are lost and a wider distrubtion in the settled can also be seen.

As well as plotting the density map, the outputs are also written to and saved as a text file (as requested in the project outline), and a brief output is printed identifying total amounts of bacteria settled vs lost, as well as the simulated time it would take for this fallout to occur, and the actual run time of the model.

---
### Tests and Trials

During the undertaking of this project, there were several hurdles faced in successfully achieving the outlined objectives. As such extensive testing was needed at several points to diagnose and resolve issues. Some of these are briefly covered here:

Firstly, to maintain consistency through all the tests and coding process a random seed was set throughout, until the code was completed and could be tested with truly random conditions. This allowed me to more quickly diagnose errors as well as replicate more fringe cases.
One such example of this was with regards to the tracking lost agents. The model was very occasionally failing due to indexing errors as it tried to mark down where bacteria had landed even outside of bounds. After extensively testing with a set seed, I identified the problem was that the bacteria were landing right on the boundary of the map which i had failed to count as lost despite the model being unable to track these coordinates.

The main hurdle I faced however, was an inability to remove bacteria from the model without causing further indexing errors in the itering for loops. Put simply, python cannot complete the loop and allow the data being processed within to be removed at the same time. After several varied attempts to circumvent this issue, I landed upon my final solution. I attached a binary 'completion' varaible to each agent, and when they needed to be deleted (be it from being lost or settled) instead of deleting them immediately (and causing the program to crash due to being in the loop) I simply marked them for removal. after each function that could lead to a need for removal I then ran a new function that removed any completed agents by overwriting the previous list with one only containing those agents that were still active.

---
## References

The wind file used to identify ground zero coordinates, and many of the controlling conditions used were defined and or/obtained from the course content noted above. Available at: https://www.geog.leeds.ac.uk/courses/computing/study/core-python-phd/


